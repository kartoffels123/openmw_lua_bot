{
  "folder_name": "Better Blocking for OpenMW",
  "lua_files": {
    "BetterBlocking0.8-54904-0-8-1719874767\\scripts\\blockMod_Player.lua": "local core = require('openmw.core')\nlocal input = require('openmw.input')\nlocal self = require('openmw.self')\nlocal time = require('openmw_aux.time')\nlocal types = require('openmw.types')\nlocal ui = require('openmw.ui')\nlocal anim = require('openmw.animation')\nlocal Controls = require('openmw.interfaces').Controls\n\nlocal I = require('openmw.interfaces')\n\nlocal BlockButton = 3\n\nlocal mySkills = types.NPC.stats.skills\nlocal myAttributes = types.NPC.stats.attributes\nlocal myBlock = mySkills.block(self).modifier\nlocal isBlocking = false\n\n\nlocal function canBlock()\n\tlocal shield = types.Actor.getEquipment(self, types.Actor.EQUIPMENT_SLOT.CarriedLeft)\n\tlocal weapon = types.Actor.getEquipment(self, types.Actor.EQUIPMENT_SLOT.CarriedRight)\n\tlocal weaponRecord = types.Weapon.records[weapon.recordId]\n\tlocal weaponTypes = types.Weapon.TYPE\n\tlocal isOneHanded = weaponRecord.type == weaponTypes.AxeOneHand or\n\tweaponRecord.type == weaponTypes.ShortBladeOneHand or\n\tweaponRecord.type == weaponTypes.LongBladeOneHand or\n\tweaponRecord.type == weaponTypes.BluntOneHand \n\n\n\n\treturn shield ~= nil\n\t\tand shield.type == types.Armor\n\t\tand types.Actor.getStance(self) == types.Actor.STANCE.Weapon\n\t\tand isBlocking == false\n\t\tand isOneHanded == true\n\n\nend\n\nlocal function blockBegin(button)\n\tif button == BlockButton and canBlock() then\n\t\tisBlocking = true\n\t\tmySkills.block(self).modifier = mySkills.block(self).modifier + 9999999\n\t\tControls.overrideCombatControls(true)\n\n\n\t\tI.AnimationController.playBlendedAnimation('activeblock', {\n\t\t\tstartkey = 'start',\n\t\t\tstopkey = 'stop',\n\t\t\tpriority = {\n\t\t\t\t[anim.BONE_GROUP.RightArm] = anim.PRIORITY.Default,\n\t\t\t\t[anim.BONE_GROUP.LeftArm] = anim.PRIORITY.Weapon,\n\t\t\t\t[anim.BONE_GROUP.Torso] = anim.PRIORITY.Weapon,\n\t\t\t\t[anim.BONE_GROUP.LowerBody] = anim.PRIORITY.Default,\n\t\t\t},\n\t\t\tautodisable = false,\n\t\t\tblendmask = anim.BLEND_MASK.LeftArm + anim.BLEND_MASK.Torso,\n\t\t})\n\tend\nend\n\nlocal function onMouseButtonRelease(button)\n\tif button == BlockButton and isBlocking then\n\t\tmySkills.block(self).modifier = mySkills.block(self).modifier - 9999999\n\t\tisBlocking = false\n\t\tControls.overrideCombatControls(false)\n\n\t\tI.AnimationController.playBlendedAnimation('idle1',\n\t\t\t{\n\t\t\t\tstartkey = 'loop start',\n\t\t\t\tstopkey = 'loop stop',\n\t\t\t\tpriority = {\n\t\t\t\t\t[anim.BONE_GROUP.RightArm] = anim.PRIORITY.Default,\n\t\t\t\t\t[anim.BONE_GROUP.LeftArm] = anim.PRIORITY.Weapon,\n\t\t\t\t\t[anim.BONE_GROUP.Torso] = anim.PRIORITY.Weapon,\n\t\t\t\t\t[anim.BONE_GROUP.LowerBody] = anim.PRIORITY.Default,\n\t\t\t\t},\n\t\t\t\tautodisable = true,\n\t\t\t})\n\tend\nend\n\nreturn {\n\tengineHandlers = {\n\t\tonMouseButtonPress = blockBegin,\n\t\tonMouseButtonRelease = onMouseButtonRelease,\n\t\tonInputAction = onInputAction,\n\t}\n}\n"
  }
}