{
  "folder_name": "No Sneaky Sleeping",
  "lua_files": {
    "No Sneaky Sleeping-53539-1-2-1717111634\\scripts\\NoSneakySleeping\\NoSneakySleeping_g.lua": "local types = require(\"openmw.types\")\nlocal acti = require(\"openmw.interfaces\").Activation\nlocal core = require(\"openmw.core\")\nlocal world = require(\"openmw.world\")\nlocal storage = require(\"openmw.storage\")\nlocal shiftPressed = false\nlocal noSleepGMST = \"sNotifyMessage64\"\nlocal deadActors = {}\n\nlocal function onPlayerAdded(player)\n  if (not world.mwscript.getGlobalVariables) then\n    player:sendEvent(\"NSS_OutOfDate\")\n      error(\"Newer version of OpenMW is required\")\n    end\nend\nlocal function isInFaction(factionId, actor)\n  for index, value in ipairs(types.NPC.getFactions(actor)) do\n    if value == factionId then\n      return types.NPC.getFactionRank(actor, factionId)\n    end\n  end\n  return -1\nend\nlocal function canUseBed(bed, actor)\n  if bed.globalVariable and world.mwscript.getGlobalVariables then\n    local var = world.mwscript.getGlobalVariables(actor)[bed.globalVariable]\n    if var == 1 then\n      return true\n    end\n  end\n  if bed.owner.factionId then\n    local bedRank = isInFaction(bed.owner.factionId, actor)\n    if bedRank == -1 or bedRank < bed.owner.factionRank then\n      return false\n    else\n      return true\n    end\n  elseif bed.owner.recordId then\n    local ownerNPCRecord = types.NPC.record(bed.owner.recordId)\n    local ownerRef\n    for index, actor in ipairs(world.activeActors) do\n      if actor.recordId == ownerNPCRecord.id then\n        ownerRef = actor\n      end\n    end\n    if ownerRef and types.Actor.stats.dynamic.health(ownerRef).current > 0 then\n      return false\n    elseif deadActors[ownerNPCRecord.id] or ownerRef and types.Actor.stats.dynamic.health(ownerRef).current <= 0 then\n      deadActors[ownerNPCRecord.id] = true\n      return true\n    end\n    return false\n  end\nend\nlocal function activateBed(object, actor)\n  local scrName = types.Activator.record(object.recordId).mwscript\n  if scrName == \"bed_standard\" and canUseBed(object, actor) == false then\n    local message = core.getGMST(noSleepGMST)\n    actor:sendEvent(\"NSS_showMessage\", message)\n\n    return false\n  end\nend\nacti.addHandlerForType(types.Activator, activateBed)\nlocal function onSave()\n  return { deadActors = deadActors }\nend\nlocal function onLoad(data)\n  if data then\n    deadActors = data.deadActors\n  end\nend\nreturn { engineHandlers = { onLoad = onLoad, onSave = onSave, onPlayerAdded = onPlayerAdded } }\n",
    "No Sneaky Sleeping-53539-1-2-1717111634\\scripts\\NoSneakySleeping\\NoSneakySleeping_p.lua": "local ui = require('openmw.ui')\nlocal I = require('openmw.interfaces')\nlocal core = require('openmw.core')\nlocal function NSS_OutOfDate()\n    I.Settings.registerPage {\n        key = \"NoSneakySleeping\",\n        l10n = \"NoSneakySleeping\",\n        name = \"NoSneakySleeping\",\n        description = \"NoSneakySleeping is enabled, but your engine version is too old. Please download a new version of OpenMW Develppment or 0.49+.(Newer than October 24, 2023)\"\n    }\nend\nif (core.API_REVISION < 50) then\n   NSS_OutOfDate()\n error(\"Newer version of OpenMW is required\")\nend\nreturn {\n    eventHandlers = {\n        NSS_showMessage = function(message)\n            ui.showMessage(message)\n        end,\n        NSS_OutOfDate = NSS_OutOfDate,\n        \n    }\n}\n"
  }
}