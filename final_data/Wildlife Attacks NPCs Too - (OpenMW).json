{
  "folder_name": "Wildlife Attacks NPCs Too - (OpenMW)",
  "lua_files": {
    "Wildlife Attacks NPCs Too-54448-1-8-1715985000\\scripts\\wildlife_npc\\wildlife.lua": "-- Note: all Ids must be in _lowercase_\n\nlocal self = require(\"openmw.self\")\nlocal ai = require(\"openmw.interfaces\").AI\nlocal types = require(\"openmw.types\")\nlocal async = require(\"openmw.async\")\n\nlocal core = require(\"openmw.core\")\nlocal nearby = require(\"openmw.nearby\")\n\nlocal aux_util = require(\"openmw_aux.util\")\n\nlocal old_API = core.API_REVISION < 59\n\n\n-- For old OpenMW 0.49 versions (API < 59 (< april 2024)):\n-- Preset fight value for wildlife creatures that we cannot check in live:\n-------------------------------------------------------------------------\nlocal oldAPIcreatures_fightV = {\n\t[\"alit_blighted\"] = 90, -- Morrowind: 90, More Passive Wildlife mod: 90\n\t[\"alit_diseased\"] = 90, -- Morrowind: 90, More Passive Wildlife mod: 85\n\t[\"cliff racer_blighted\"] = 90, -- Morrowind: 90\n\t[\"cliff racer_diseased\"] = 90, -- Morrowind: 90\n\t[\"kagouti_blighted\"] = 90, -- Morrowind: 90, More Passive Wildlife mod: 90\n\t[\"kagouti_diseased\"] = 90, -- Morrowind: 90, More Passive Wildlife mod: 85\n\t[\"kwama forager blighted\"] = 85, -- Morrowind: 85, More Passive Wildlife mod: 90\n\t[\"kwama warrior blighted\"] = 90, -- Morrowind: 90, More Passive Wildlife mod: 90\n\t[\"kwama warrior shurdan\"] = 90, -- Morrowind: 90\n\t[\"kwama worker blighted\"] = 90, -- Morrowind: 90, More Passive Wildlife mod: 90\n\t[\"kwama worker diseased\"] = 50, -- Morrowind: 50\n\t[\"mudcrab-diseased\"] = 83, -- Morrowind: 83, More Passive Wildlife mod: 81\n\t[\"netch_betty_ranched\"] = 30, -- Morrowind: 30\n\t[\"netch_bull_ranched\"] = 30, -- Morrowind: 30\n\t[\"nix-hound blighted\"] = 90, -- Morrowind: 90, More Passive Wildlife mod: 90\n\t[\"rat_blighted\"] = 85, -- Morrowind: 85, More Passive Wildlife mod: 90\n\t[\"rat_diseased\"] = 85, -- Morrowind: 85, More Passive Wildlife mod: 85\n\t[\"rat_plague\"] = 85, -- Morrowind: 85\n\t[\"rat_plague_hall1\"] = 85, -- Morrowind: 85\n\t[\"rat_plague_hall1a\"] = 85, -- Morrowind: 85\n\t[\"scrib blighted\"] = 50, -- Morrowind: 50, More Passive Wildlife mod: 95\n\t[\"scrib diseased\"] = 50, -- Morrowind: 50\n\t[\"shalk_blighted\"] = 90, -- Morrowind: 90\n\t[\"shalk_diseased\"] = 90, -- Morrowind: 90\n-----------------------------------------------------------------------\n\t[\"alit\"] = \"fight_tokens\",\n\t[\"bm_bear_black\"] = \"fight_tokens\",\n\t[\"bm_bear_brown\"] = \"fight_tokens\",\n\t[\"bm_frost_boar\"] = \"fight_tokens\",\n\t[\"bm_wolf_grey\"] = \"fight_tokens\",\n\t[\"bm_wolf_grey_lvl_1\"] = \"fight_tokens\",\n\t[\"bm_wolf_red\"] = \"fight_tokens\",\n\t[\"cliff racer\"] = \"fight_tokens\",\n\t[\"dreugh\"] = \"fight_tokens\",\n\t[\"guar\"] = \"fight_tokens\",\n\t[\"guar_feral\"] = \"fight_tokens\",\n\t[\"guar_pack\"] = \"fight_tokens\",\n\t[\"kagouti\"] = \"fight_tokens\",\n\t[\"kagouti_mating\"] = \"fight_tokens\",\n\t[\"kwama forager\"] = \"fight_tokens\",\n\t[\"kwama warrior\"] = \"fight_tokens\",\n\t[\"kwama worker\"] = \"fight_tokens\",\n\t[\"kwama worker entrance\"] = \"fight_tokens\",\n\t[\"mudcrab\"] = \"fight_tokens\",\n\t[\"mudcrab_hrmudcrabnest\"] = \"fight_tokens\",\n\t[\"netch_betty\"] = \"fight_tokens\",\n\t[\"netch_bull\"] = \"fight_tokens\",\n\t[\"nix-hound\"] = \"fight_tokens\",\n\t[\"rat\"] = \"fight_tokens\",\n\t[\"rat_cave_fgrh\"] = \"fight_tokens\",\n\t[\"rat_cave_fgt\"] = \"fight_tokens\",\n\t[\"scrib\"] = \"fight_tokens\",\n\t[\"shalk\"] = \"fight_tokens\",\n\t[\"slaughterfish\"] = \"fight_tokens\",\n\t[\"slaughterfish_small\"] = \"fight_tokens\",\n}\n\n-- For new OpenMW 0.49 versions (API >= 59 (>= april 2024)):\nlocal newAPIcreatures_fightV = {\n\t[\"alit\"] = true,\n\t[\"alit_blighted\"] = true,\n\t[\"alit_diseased\"] = true,\n\t[\"bm_bear_black\"] = true,\n\t[\"bm_bear_brown\"] = true,\n\t[\"bm_frost_boar\"] = true,\n\t[\"bm_wolf_grey\"] = true,\n\t[\"bm_wolf_grey_lvl_1\"] = true,\n\t[\"bm_wolf_red\"] = true,\n\t[\"cliff racer\"] = true,\n\t[\"cliff racer_blighted\"] = true,\n\t[\"cliff racer_diseased\"] = true,\n\t[\"dreugh\"] = true,\n\t[\"guar\"] = true,\n\t[\"guar_feral\"] = true,\n\t[\"guar_pack\"] = true,\n\t[\"kagouti\"] = true,\n\t[\"kagouti_mating\"] = true,\n\t[\"kagouti_blighted\"] = true,\n\t[\"kagouti_diseased\"] = true,\n\t[\"kwama forager\"] = true,\n\t[\"kwama forager blighted\"] = true,\n\t[\"kwama warrior\"] = true,\n\t[\"kwama warrior blighted\"] = true,\n\t[\"kwama warrior shurdan\"] = true,\n\t[\"kwama worker\"] = true,\n\t[\"kwama worker entrance\"] = true,\n\t[\"kwama worker blighted\"] = true,\n\t[\"kwama worker diseased\"] = true,\n\t[\"mudcrab\"] = true,\n\t[\"mudcrab-diseased\"] = true,\n\t[\"mudcrab_hrmudcrabnest\"] = true,\n\t[\"netch_betty\"] = true,\n\t[\"netch_betty_ranched\"] = true,\n\t[\"netch_bull\"] = true,\n\t[\"netch_bull_ranched\"] = true,\n\t[\"nix-hound\"] = true,\n\t[\"nix-hound blighted\"] = true,\n\t[\"rat\"] = true,\n\t[\"rat_cave_fgrh\"] = true,\n\t[\"rat_cave_fgt\"] = true,\n\t[\"rat_blighted\"] = true,\n\t[\"rat_diseased\"] = true,\n\t[\"rat_plague\"] = true,\n\t[\"rat_plague_hall1\"] = true,\n\t[\"rat_plague_hall1a\"] = true,\n\t[\"scrib\"] = true,\n\t[\"scrib blighted\"] = true,\n\t[\"scrib diseased\"] = true,\n\t[\"shalk\"] = true,\n\t[\"shalk_blighted\"] = true,\n\t[\"shalk_diseased\"] = true,\n\t[\"slaughterfish\"] = true,\n\t[\"slaughterfish_small\"] = true,\n}\n\n-- Blacklist example for NPCs not to be attacked.\n-- Change and add as you want.\n-- To activate the blacklist, see my explanation below in the code.\nlocal NPCsBlacklist = {\n\t[\"fargoth\"] = true,\n\t[\"vodunius nuccius\"] = true,\n\t-- ...\n}\n\t\nlocal wildlife\nlocal fightV\nlocal nearestNPC, distToNPC\n\n\nlocal function wildlifeAtk()\n\n\tif wildlife == \"no\" then return end\n\t\n\tasync:newUnsavableSimulationTimer(3, wildlifeAtk)\n\n\tif types.Actor.stats.dynamic.health(self).current < 1\n\t  or (ai.getActivePackage() ~= nil and ai.getActivePackage().type ~= \"Wander\" and ai.getActivePackage().type ~= \"Unknown\") then\n\t\treturn\n\tend\n\t\n  if old_API then\n\n\tfightV = oldAPIcreatures_fightV[self.recordId]\n\t\n\tif fightV == \"fight_tokens\" then\n\t\tfightV = types.Actor.inventory(self):countOf(\"ll_fight_token\")\n\telseif fightV == nil then\n\t\twildlife = \"no\"\n\t\treturn\n\tend\n\t\n  else\n\n\tif newAPIcreatures_fightV[self.recordId] then\n\t\tfightV = types.Actor.stats.ai.fight(self).modified\n\telse\n\t\twildlife = \"no\"\n\t\treturn\n\tend\n\n  end\n\n\n\t-- Find the nearest alive NPC\n\tnearestNPC, distToNPC = aux_util.findMinScore(\n\t\tnearby.actors,\n\t\tfunction(actor)\n\t\t\treturn actor.type == types.NPC and types.Actor.isDead(actor) == false and (self.position - actor.position):length()\n\t\tend)\n\t\n\t-- Optionnal NPCs blacklist.\n\t-- To activate the blacklist, remove \"--\" from the begining of the next line.\n\t-- if NPCsBlacklist[nearestNPC.recordId] then return end\n\t\n\tif distToNPC and distToNPC < (fightV - 80) * 200 then\n           ai.startPackage({\n               type = \"Combat\",\n               target = nearestNPC,\n               cancelOther = false\n           })\n\tend\n\n--print(\"*****************************\")\n--print(\"crea:\")\n--print(self)\n--print(\"distToNPC:\")\n--print(distToNPC)\n--print(\"fightV:\")\n--print(fightV)\n\n  return {\n    engineHandlers = {\n        onLoad = onLoad,\n        onSave = onSave\n    }\n  }\nend\n\nasync:newUnsavableSimulationTimer(1, wildlifeAtk)\n"
  }
}