{
  "folder_name": "(OpenMW 0.49) Unpaused Tradeskills",
  "lua_files": {
    "Unpaused Tradeskills-54860-1-1-1718829078\\UnpausedTradeskills\\scripts\\UnpausedTradeskills\\UPTS_g.lua": "local acti = require(\"openmw.interfaces\").Activation\nlocal types = require('openmw.types')\nlocal world = require('openmw.world')\nlocal aux_util = require('openmw_aux.util')\nlocal MOD_NAME = \"UnpausedTradeskills\"\nlocal storage = require('openmw.storage')\nlocal globalSection = storage.globalSection(\"SettingsGlobal\" .. MOD_NAME)\nlocal async = require('openmw.async')\nlocal I = require(\"openmw.interfaces\")\nlocal view = aux_util.deepToString\nlocal playerModes = {}\n\nlocal slowMoMadness = false\nlocal durationSlowdownCurve = {\n[1] = 1,\n[2] = 0.99,\n[3] = 0.97,\n[4] = 0.94,\n[5] = 0.9,\n[6] = 0.85,\n[7] = 0.80,\n[8] = 0.75,\n[9] = 0.70,\n[10] = 0.65,\n[11] = 0.60,\n[12] = 0.55,\n[13] = 0.5,\n[14] = 0.45,\n[15] = 0.4,\n}\n\n\n\nlocal function updateSettings()\n\tunpauseUIs = {\n\t\t-- [\"Book\"] = true,\n\t\t-- [\"Scroll\"] = true,\n\t\t-- [\"Interface\"] = true,\n\t\t-- [\"Inventory\"] = true,\n\t\t-- [\"MainMenu\"] = true,\n\t\t-- [\"Rest\"] = true,\n\t\t-- [\"QuickKeysMenu\"] = true,\n\t\t-- [\"Journal\"] = true,\n\t\t-- [\"Name\"] = true,\n\t\t-- [\"Race\"] = true,\n\t\t-- [\"Class\"] = true,\n\t\t-- [\"ClassPick\"] = true,\n\t\t-- [\"ClassCreate\"] = true,\n\t\t-- [\"Birth\"] = true,\n\t\t-- [\"ClassGenerate\"] = true,\n\t\t-- [\"Review\"] = true,\n\t\t-- [\"Levelup\"] = true,\n\t\t-- [\"Jail\"] = true,\n\t\t-- [\"Companion\"] = true,\n\t\t\n\t\t[\"Dialogue\"] = not globalSection:get(\"pauseOnDialogue\"),\n\t\t[\"Container\"] = not globalSection:get(\"pauseOnContainer\"),\n\t\t[\"SpellBuying\"] = true,\n\t\t[\"SpellCreation\"] = true,\n\t\t[\"Barter\"] = true,\n\t\t[\"Alchemy\"] = true,\n\t\t[\"Recharge\"] = true,\n\t\t[\"Enchanting\"] = true,\n\t\t[\"Training\"] = true,\n\t\t[\"MerchantRepair\"] = true,\n\t\t[\"Repair\"] = true,\n\t\t[\"Travel\"] = true,\n\t}\nend\nupdateSettings()\n--local function activateContainer(cont, player)\n--\tplayer:sendEvent(\"TakeAll_openedContainer\", {cont, player})\n--end\n\n\n\nlocal function unpackTable(t)\n\tr = \"\" \n\tfor a,b in pairs(t) do\n\t\tr = r..a..\"=\"..tostring(b)..\", \"\n\tend\n\treturn r\nend\n\nlocal function playerChangesMode(data)\n\t--print(data.player, data.mode)\n\tif data.mode == nil then\n\t\tplayerModes[data.player.id] = nil\n\telse\n\t\tlocal shortestBuff = 99999\n\t\tif globalSection:get(\"slowMoMadness\") then\n\t\t\tfor a,b in pairs(types.Actor.activeSpells(data.player)) do\n\t\t\t\tfor c,d in pairs(b.effects) do\n\t\t\t\t\tprint(d.id,d.hasDuration,d.duration)\n\t\t\t\t\tif (d.id == \"fortifyattribute\" or d.id == \"fortifyskill\") and d.duration then\n\t\t\t\t\t\tshortestBuff = math.min(shortestBuff,d.duration)\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\tend\n\t\tend\n\t\tplayerModes[data.player.id] = {mode = data.mode, shortestBuff = shortestBuff}\n\t\t--print(shortestBuff)\n\tend\n\tif world.getPausedTags().ui then\n\t\tlocal unpause = true\n\t\tlocal shortestBuff = 99999\n\t\tfor i,m in pairs(playerModes) do\n\t\t\t--print(m,unpauseUIs[m])\n\t\t\tif not unpauseUIs[m.mode] then\n\t\t\t\tunpause = false\n\t\t\telse\n\t\t\t\tshortestBuff = math.min(shortestBuff,m.shortestBuff)\n\t\t\tend\n\t\tend\n\t\tif unpause then\n\t\t\tworld.unpause(\"ui\")\n\t\t\tif shortestBuff ~= 99999 then\n\t\t\t\tlocal slowDown = 1\n\t\t\t\tfor a,b in ipairs(durationSlowdownCurve) do\n\t\t\t\t\tif shortestBuff >= a then\n\t\t\t\t\t\tslowDown = b\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tworld.setSimulationTimeScale(math.min(1,(math.max(0.05, slowDown))))\n\t\t\t\t--print(world.getSimulationTimeScale())\n\t\t\telse\n\t\t\t\tworld.setSimulationTimeScale(1)\n\t\t\t\t--print(1)\n\t\t\tend\n\t\telse\n\t\t--\tworld.pause(\"ui\") -- game does this automatically?\n\t\t\tworld.setSimulationTimeScale(1)\n\t\t\t--print(1)\n\t\tend\n\telse\n\t\tworld.setSimulationTimeScale(1)\n\t\t--print(1)\n\tend\nend\n\n\nI.Settings.registerGroup {\n\tkey = \"SettingsGlobal\" .. MOD_NAME,\n\tl10n = MOD_NAME,\n\tname = \"\",\n\tpage = MOD_NAME,\n\tdescription = \"\",\n\tpermanentStorage = true,\n\tsettings = {\n\t\t\n\t\t{\n\t\t\tkey = \"pauseOnDialogue\",\n\t\t\tname = \"pauseOnDialogue\",\n\t\t\tdescription = \"\",\n\t\t\tdefault = false,\n\t\t\trenderer = 'checkbox',\n\t\t},\n\t\t{\n\t\t\tkey = \"pauseOnContainer\",\n\t\t\tname = \"pauseOnContainer\",\n\t\t\tdescription = \"\",\n\t\t\tdefault = true,\n\t\t\trenderer = 'checkbox',\n\t\t},\n\t\t{\n\t\t\tkey = \"slowMoMadness\",\n\t\t\tname = \"Slow Mo Relaxed Tradeskills\",\n\t\t\tdescription = \"Slows down time if your shortest fortify spell is pretty long\",\n\t\t\tdefault = false,\n\t\t\trenderer = 'checkbox',\n\t\t},\n\t}\n}\nglobalSection:subscribe(async:callback(updateSettings))\n\nreturn {\n\teventHandlers = {\n\t\tUnpausedTradeskills_playerChangesMode = playerChangesMode,\n\t},\n\tengineHandlers = { \n\t\tonUpdate = onUpdate,\n\t},\n}",
    "Unpaused Tradeskills-54860-1-1-1718829078\\UnpausedTradeskills\\scripts\\UnpausedTradeskills\\UPTS_npc.lua": "local self = require('openmw.self')\nlocal util = require('openmw.util')\n\nlocal dialogTarget = nil\nlocal turningToTarget = false\n\nlocal function onUpdate(dt)\n    if dialogTarget then\n        self.controls.movement = 0\n        self.controls.sideMovement = 0\n        local deltaPos = dialogTarget.position - self.position\n        local destVec = util.vector2(deltaPos.x, deltaPos.y):rotate(self.rotation:getYaw())\n        local deltaYaw = math.atan2(destVec.x, destVec.y)\n        if math.abs(deltaYaw) < math.rad(10) then\n            turningToTarget = false\n        elseif math.abs(deltaYaw) > math.rad(30) then\n            turningToTarget = true\n        end\n        if turningToTarget then\n            self.controls.yawChange = util.clamp(deltaYaw, -dt * 2.5, dt * 2.5)\n        else\n            self.controls.yawChange = 0\n        end\n    end\nend\n\nreturn {\n    eventHandlers = {\n        UnpausedTradeskills_StartDialog = function(player) dialogTarget = player end,\n        UnpausedTradeskills_StopDialog = function() dialogTarget = nil end,\n    },\n    engineHandlers = {\n        onUpdate = onUpdate,\n    },\n}\n\n",
    "Unpaused Tradeskills-54860-1-1-1718829078\\UnpausedTradeskills\\scripts\\UnpausedTradeskills\\UPTS_p.lua": "local ui = require('openmw.ui')\nlocal I = require(\"openmw.interfaces\")\nlocal core = require(\"openmw.core\")\nlocal types = require('openmw.types')\nlocal self = require('openmw.self')\nlocal ambient = require('openmw.ambient')\nlocal resources = types.Actor.stats.dynamic\nlocal MODE = I.UI.MODE\nlocal windows = require('scripts.uimodes.windows')\nlocal MOD_NAME = \"UnpausedTradeskills\"\n\nlocal dialogModes = {\n    Barter = true,\n    Companion = true,\n    Dialogue = true,\n    Enchanting = true,\n    MerchantRepair = true,\n    SpellBuying = true,\n    SpellCreation = true,\n    Training = true,\n    Travel = true,\n}\n\n\n\nfunction uiModeChanged(m)\n\tcore.sendGlobalEvent(\"UnpausedTradeskills_playerChangesMode\",{player = self, mode = m.newMode})\n\t\n    if m.newMode == nil then\n        windows.mode = nil\n        if currentDialogTarget then\n            currentDialogTarget:sendEvent('UnpausedTradeskills_StopDialog')\n            currentDialogTarget = nil\n        end\n    end\n    if m.newMode ~= MODE.Interface then windows.closeModeMenu() end\n    if dialogModes[m.newMode] and m.arg and m.arg ~= currentDialogTarget then --and settings.dialogsDontPause()\n        if currentDialogTarget then\n            currentDialogTarget:sendEvent('UnpausedTradeskills_StopDialog')\n        end\n        m.arg:sendEvent('UnpausedTradeskills_StartDialog', self)\n        currentDialogTarget = m.arg\n    end\n\t\nend\n\n\nI.Settings.registerPage {\n\tkey = MOD_NAME,\n\tl10n = MOD_NAME,\n\tname = \"Unpaused Tradeskills\",\n\tdescription = \"\"\n}\n\nreturn {\n\teventHandlers = {\n\t\tUiModeChanged\t= uiModeChanged,\n\t}\n}"
  }
}